<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Competitive Catabolism - Multi-Nutrient Model Simulator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .visitor-badge {
            position: fixed;
            top: 15px;
            right: 15px;
            background: white;
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            border: 1px solid #0891b2;
            min-width: 140px;
            transition: opacity 0.3s ease, transform 0.3s ease;
            opacity: 1;
            transform: translateY(0);
        }
        
        .visitor-badge.hidden {
            opacity: 0;
            transform: translateY(-20px);
            pointer-events: none;
        }
        
        .visitor-badge h3 {
            font-size: 10px;
            color: #64748b;
            margin: 0 0 6px 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }
        
        .visitor-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 4px 0;
            padding: 4px 6px;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 6px;
        }
        
        .visitor-icon {
            font-size: 16px;
        }
        
        .visitor-info {
            flex: 1;
        }
        
        .visitor-label {
            font-size: 9px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            font-weight: 500;
            line-height: 1;
        }
        
        .visitor-number {
            font-size: 14px;
            font-weight: 700;
            color: #0891b2;
            line-height: 1.2;
        }
        
        .pulse {
            display: inline-block;
            width: 6px;
            height: 6px;
            background: #10b981;
            border-radius: 50%;
            margin-left: 3px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        
        @media (max-width: 768px) {
            .visitor-badge {
                position: fixed;
                top: auto;
                bottom: 15px;
                left: 50%;
                transform: translateX(-50%);
                right: auto;
                margin: 0;
                max-width: 200px;
            }
            
            .visitor-badge.hidden {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
                pointer-events: none;
            }
        }
    </style>
</head>
<body>
    <!-- Visitor Counter Badge -->
    <div class="visitor-badge">
        <h3>ðŸ‘‹ Welcome!</h3>
        <div class="visitor-stat">
            <span class="visitor-icon">ðŸŸ¢</span>
            <div class="visitor-info">
                <div class="visitor-label">Online Now</div>
                <div class="visitor-number"><span id="active-count">1</span><span class="pulse"></span></div>
            </div>
        </div>
        <div class="visitor-stat">
            <span class="visitor-icon">ðŸŒŸ</span>
            <div class="visitor-info">
                <div class="visitor-label">Total Visits</div>
                <div class="visitor-number" id="total-count">{{ visitor_count }}</div>
            </div>
        </div>
    </div>
    
    <header>
        <h1>Explore Competitive Catabolism</h1>
        <p>An interactive simulator of mammalian fasted homeostasis</p>
    </header>
    
    <div class="container">
        <div class="info-section">
            <h2>About This Simulator</h2>
            <div style="display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-start;">
                <div style="flex: 1; min-width: 300px;">
                    <p>
                        This web application provides interactive simulations for fasted metabolite dynamics.
                        Explore how different nutrients (glucose, fatty acids, 
                        lactate, and ketones) compete for oxidation under various physiological and pathological 
                        conditions. 
                        Simulations are based on a validated computational model (presented
                         <a href="https://www.biorxiv.org/content/10.1101/2025.10.29.684184">here</a>).
                        This web application allows you to manipulate parameters to reproduce the finding we present in the publication, 
                        and also to explore new scenarios beyond those described in the paper. 
                        We hope this tool will help you understand fuel competition and its implications for metabolic health.
                    </p>
                    <p>
                        <strong>New to the model?</strong> Check out the <a href="/parameters">model parameters</a> 
                        to understand their physiological meaning.
                    </p>
                </div>
                <div style="flex: 1; min-width: 300px; text-align: center;">
                    <img src="/static/model.svg" alt="Competitive Catabolism Model" style="max-width: 75%; height: auto; max-height: 300px;">
                </div>
            </div>
        </div>
        
        <div class="simulation-grid">
            <a href="/dynamic_response" class="simulation-card">
                <h2>Dynamic Responses</h2>
                <p>Simulate metabolic dynamics in response to parameter perturbations, e.g. Type 1 Diabetes progression.</p>
                <span class="btn-primary">Launch Simulation â†’</span>
            </a>
            
            <a href="/insulin_clamp" class="simulation-card">
                <h2>Insulin Clamps</h2>
                <p>Model hyperinsulinemic-euglycemic clamp experiments with variable metabolite infusions.</p>
                <span class="btn-primary">Launch Simulation â†’</span>
            </a>
            
            <a href="/tolerance_tests" class="simulation-card">
                <h2>Tolerance Tests (GTT/ITT)</h2>
                <p>Simulate Glucose Tolerance Tests (GTT) and Insulin Tolerance Tests (ITT).</p>
                <span class="btn-primary">Launch Simulation â†’</span>
            </a>
            
            <a href="/obesity" class="simulation-card">
                <h2>Obesity Simulations</h2>
                <p>Explore how adiposity affects glucose homeostasis and insulin resistance.</p>
                <span class="btn-primary">Launch Simulation â†’</span>
            </a>
            
            <a href="/treatment" class="simulation-card">
                <h2>Predict Treatment Strategies</h2>
                <p>Explore protential treatment strategies for different metabolic dysfunctions.</p>
                <span class="btn-primary">Launch Simulation â†’</span>
            </a>
        </div>
    </div>
    
    <footer class="site-footer">
        <p>&copy; 2025 Competitive Catabolism Project. Licensed under Apache License 2.0.</p>
        <div class="footer-links">
            <a href="/about">About</a>
            <a href="/privacy">Privacy Policy</a>
            <a href="/terms">Terms of Service</a>
        </div>
    </footer>
    
    <script>
        // Update visitor counts every 10 seconds
        function updateVisitorCounts() {
            fetch('/api/visitor_count')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('total-count').textContent = data.total;
                    document.getElementById('active-count').textContent = data.active;
                })
                .catch(error => {
                    console.error('Error fetching visitor count:', error);
                });
        }
        
        // Update on page load
        updateVisitorCounts();
        
        // Update every 10 seconds
        setInterval(updateVisitorCounts, 10000);
        
        // Hide badge when scrolling down
        let lastScrollTop = 0;
        const badge = document.querySelector('.visitor-badge');
        const isMobile = window.innerWidth <= 768;
        
        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (isMobile) {
                // On mobile, hide when scrolling in any direction
                if (scrollTop > 50) {
                    badge.classList.add('hidden');
                } else {
                    badge.classList.remove('hidden');
                }
            } else {
                // On desktop, hide when scrolling down past 100px
                if (scrollTop > 100 && scrollTop > lastScrollTop) {
                    badge.classList.add('hidden');
                } else if (scrollTop < 50) {
                    badge.classList.remove('hidden');
                }
            }
            
            lastScrollTop = scrollTop;
        });
    </script>
</body>
</html>